#!/bin/bash
# @author pataar

if [ $# -lt 1 ]
  then
    echo "Please use it as sync-release <release>"
    exit 1
fi

release_branch="release/$1"
current_branch=$(git rev-parse --abbrev-ref HEAD)

echo -e "Starting sync for $1..."
git checkout master --quiet;
git fetch -p --quiet;
echo -e "Pulling develop..."
git fetch origin develop:develop --quiet;
echo -e "Pulling acceptance..."
git fetch origin acceptance:acceptance --quiet;
echo -e "Pulling $release_branch..."
git fetch origin $release_branch:$release_branch --quiet;
echo -e "Merging $release_branch into acceptance..."
git checkout acceptance --quiet;
git merge $release_branch --no-edit --quiet;
git checkout - --quiet;
echo -e "Merging $release_branch into develop..."
git checkout develop --quiet;
git merge $release_branch --no-edit --quiet
git checkout - --quiet;
echo -e "Pushing acceptance..."
git push origin acceptance:acceptance --quiet;
echo -e "Pushing develop..."
git push origin develop:develop --quiet;
git checkout $current_branch --quiet
echo "Done syncing $release_branch!"
